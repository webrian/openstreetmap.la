L.Control.Status=L.Control.Attribution.extend({options:{position:"topright",tpl:null},initialize:function(a){L.Util.setOptions(this,a)},onAdd:function(a){this._container=L.DomUtil.create("div","leaflet-control-status");this._map=a;this._attributions={};this._update();return this._container},setText:function(a){this.options.tpl.overwrite(this._container,[a])}});L.OsmMarker=L.Marker.extend({options:{mouseoverText:Ext.ux.ts.tr("Drag to change route or double click to remove"),mouseoutText:"",draggable:true,ctrl:null},initialize:function(b,a){L.Util.setOptions(this,a);this._latlng=b;this.on("mouseover",function(c){this.options.ctrl.setText(this.options.mouseoverText)});this.on("mouseout",function(c){this.options.ctrl.setText(this.options.mouseoutText)})},onRemove:function(a){L.Marker.prototype.onRemove.call(this,a);this.options.ctrl.setText(this.options.mouseoutText)}});L.StartIcon=L.Icon.extend({options:{iconAnchor:new L.Point(12,41),iconSize:new L.Point(25,41),iconUrl:"/img/startmarker.png",shadowUrl:"/lib/leaflet-0.4.4/dist/images/marker-shadow.png"}});L.EndIcon=L.Icon.extend({options:{iconAnchor:new L.Point(12,41),iconSize:new L.Point(25,41),iconUrl:"/img/endmarker.png",shadowUrl:"/lib/leaflet-0.4.4/dist/images/marker-shadow.png"}});L.ViaIcon=L.Icon.extend({options:{iconUrl:"/img/viamarker.png",shadowUrl:"/img/viamarker-shadow.png",iconSize:new L.Point(12,12),shadowSize:new L.Point(12,12),iconAnchor:new L.Point(6,6),popupAnchor:new L.Point(-6,-6)}});
/*!
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.onReady(function(){var I=null;var M=null;var H=new Array();var y=null;var P=null;var m=initLang;var v="map";var R='<a class="external" href="http://www.openstreetmap.org/edit?lat={lat}&lon={lon}&zoom={zoom}">'+Ext.ux.ts.tr("edit the map")+" </a>";var S=new Ext.Template(R);S.compile();var U=Ext.DomHelper.createTemplate({html:"{0}",tag:"div"});U.compile();Ext.Ajax.on("beforerequest",function(i){J.setText(Ext.ux.ts.tr("Loading..."))},this);Ext.Ajax.on("requestcomplete",function(i){J.setText("")},this);var D='map &copy; <a href="http://www.osm-tools.org">osm-tools.org</a>,\n            data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors';var d="http://{s}.laostile.osm-tools.org/osm_en/{z}/{x}/{y}.png";var p=new L.TileLayer(d,{attribution:D,minZoom:5,maxZoom:18});var x="http://{s}.laostile.osm-tools.org/osm_th/{z}/{x}/{y}.png";var Q=new L.TileLayer(x,{attribution:D,minZoom:5,maxZoom:18});var N="/tms/1.0.0/landsat8/{z}/{x}/{y}.jpeg";var s=new L.TileLayer(N,{attribution:'Landsat 8 <a href="http://eros.usgs.gov/#/About_Us/Customer_Service/Data_Citation">imagery available from the U.S. Geological Survey</a>,\n            data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',minZoom:5,maxZoom:14,tms:true});var G={map:{en:p,lo:Q},satellite:{en:s,lo:s}};Ext.encode(G);var u=new L.Map("map");u.addLayer(G[v][m]);u.attributionControl.setPrefix("");var J=new L.Control.Status({tpl:U});u.addControl(J);J.setText("");var T=new Ext.ux.LocationComboBox({listeners:{select:function(Z,i,X){var aa=Fgh.decode(i.data.hash);var Y=new L.LatLng(aa.lat,aa.lon);K(Y,true)}},map:u,width:325});var V=new Ext.ux.LanguageToolbar({currentLang:m,statusControl:J,url:"/"});var e=new Ext.Button({handler:function(i){u.removeLayer(G[v][m]);v="map";u.addLayer(G[v][m])},iconCls:"map-button",iconAlign:"top",listeners:{mouseover:function(X,i){J.setText(Ext.ux.ts.tr("Map"))},mouseout:function(X,i){J.setText("")}},pressed:v=="map",style:{padding:"0px 2px 0px"},tooltip:Ext.ux.ts.tr("Map"),toggleGroup:"maptype"});var o=new Ext.Button({handler:function(i){u.removeLayer(G[v][m]);v="satellite";u.addLayer(G[v][m])},iconCls:"satellite-button",iconAlign:"top",listeners:{mouseover:function(X,i){J.setText(Ext.ux.ts.tr("Satellite"))},mouseout:function(X,i){J.setText("")}},pressed:v=="satellite",style:{padding:"0px 2px 0px"},tooltip:Ext.ux.ts.tr("Satellite"),toggleGroup:"maptype"});V.insertButton(1,"-");V.insertButton(1,{cls:"x-btn-text-icon",handler:function(i){var X=A(m);window.location.href=X},iconCls:"link-button",iconAlign:"right",listeners:{mouseover:function(X,i){J.setText(Ext.ux.ts.tr("Permanent link to current map view"))},mouseout:function(X,i){J.setText("")}}});V.insertButton(1,"-");V.insertButton(1,e);V.insertButton(1,o);V.insert(0,T);var C=new Ext.ux.MapPanel({center:initCenter,contentEl:"map",editEl:"edit-link",editTpl:S,id:"map-tabpanel",map:u,tbar:V,title:Ext.ux.ts.tr("Map"),zoom:initZoom});var h=new Ext.TabPanel({activeTab:"map-tabpanel",items:[C,{autoScroll:true,contentEl:"edit-tab",id:"edit-tabpanel",title:Ext.ux.ts.tr("Edit"),tbar:new Ext.ux.LanguageToolbar({currentLang:m,statusControl:J,url:"/edit/"}),xtype:"panel"},{autoScroll:true,contentEl:"downloads-tab",id:"downloads-tabpanel",title:Ext.ux.ts.tr("Downloads"),tbar:new Ext.ux.LanguageToolbar({currentLang:m,statusControl:J,url:"/downloads/"}),xtype:"panel"},{autoScroll:true,contentEl:"about-tab",id:"about-tabpanel",title:Ext.ux.ts.tr("About this page"),tbar:new Ext.ux.LanguageToolbar({currentLang:m,statusControl:J,url:"/about/"}),xtype:"panel"}],listeners:{afterrender:function(i){i.setActiveTab(Ext.ux.activeTab+"-tabpanel")}},region:"center"});var t=new Ext.ux.LocationComboBox({emptyText:Ext.ux.ts.tr("Search village, point of interest, etc."),listeners:{select:function(Z,i,X){var aa=Fgh.decode(i.data.hash);var Y=new L.LatLng(aa.lat,aa.lon);a(Y,true)}},map:u});var j=new Ext.ux.LocationComboBox({emptyText:Ext.ux.ts.tr("Search village, point of interest, etc."),listeners:{select:function(Z,i,X){var aa=Fgh.decode(i.data.hash);var Y=new L.LatLng(aa.lat,aa.lon);r(Y,true)},scope:this},map:u});var l=Ext.DomHelper;var B=l.createTemplate({tag:"tr",id:"row{0}",children:[{tag:"td",html:"{0}.",cls:"{1}"},{tag:"td",html:"{2} {3}",cls:"{1}"},{tag:"td",html:"{4}",cls:"{1}"}]});var n=l.createTemplate({tag:"div",html:Ext.ux.ts.tr("Distance")+": <b>"+Ext.ux.ts.tr("{0} km")+"</b><br/>"+Ext.ux.ts.tr("Duration")+": <b>"+Ext.ux.ts.tr("{1} h {2} mins")+"</b>"});var E=new Ext.Panel({autoScroll:true,region:"center",contentEl:"route-result-panel",id:"routingpanel",baseCls:"x-panel",ctCls:"x-panel-mc"});var F=new Ext.Panel({items:[{align:"stretch",height:350,items:[{baseCls:"x-panel",contentEl:"sidepanel-header",ctCls:"x-panel-mc",width:250,xtype:"panel"},{bodyStyle:"padding: 10px 0px 0px 10px",buttonAlign:"right",defaults:{width:230},hideLabels:true,items:[{id:"get-directions-header",html:"<h1>"+Ext.ux.ts.tr("Get directions")+"</h1>",xtype:"label"},{hideLabel:true,items:[t,{handler:function(X,i){a(u.getCenter(),false);t.setLocationValue(u.getCenter())},iconCls:"startmarker",tooltip:Ext.ux.ts.tr("Add start"),tooltipType:"title",xtype:"button"}],width:"auto",xtype:"compositefield"},{hideLabel:true,items:[j,{handler:function(X,i){r(u.getCenter(),false);j.setLocationValue(u.getCenter())},iconCls:"endmarker",tooltip:Ext.ux.ts.tr("Add destination"),tooltipType:"title",xtype:"button"}],width:"auto",xtype:"compositefield"},{handler:function(Z,X){w();b();for(var Y=0;Y<H.length;Y++){u.removeLayer(H[Y]);u.closePopup()}H=new Array();t.clearValue();j.clearValue();k(false)},text:Ext.ux.ts.tr("Clear"),width:100,xtype:"button"}],width:250,xtype:"form"},{baseCls:"x-panel",contentEl:"route-summary-panel",ctCls:"x-panel-mc",width:250,xtype:"panel"}],layout:"vbox",region:"north",xtype:"panel"},E],layout:"border",region:"west",width:250});var W=new Ext.Viewport({layout:"border",items:[F,h]});W.render("main");if(initStart){a(initStart,false);t.setLocationValue(initStart)}if(initDest){r(initDest,false);j.setLocationValue(initDest)}if(initVias){for(var O=0;O<initVias.length;O++){f(initVias[O])}}if(initMarker){K(initMarker,false);T.setLocationValue(y.getLatLng())}function A(ad){var aj=u.getCenter();var ak=u.getZoom();var ah="";if(y){var al=y.getLatLng();ah="&mlat="+al.lat+"&mlon="+al.lng}var aa="";if(I){var ae=I.getLatLng();var af=Fgh.encode(ae.lat,ae.lng,52);aa="&start="+af}var am="";if(M){var ag=M.getLatLng();var Z=Fgh.encode(ag.lat,ag.lng,52);am="&dest="+Z}var ai="";if(H.length>0){ai+="&via=";for(var ac=0;ac<H.length;ac++){var Y=H[ac].getLatLng();var ab=Fgh.encode(Y.lat,Y.lng,52);ai+=ab;if(ac<(H.length-1)){ai+=","}}}var X="&lang="+ad;return"/?lat="+aj.lat+"&lon="+aj.lng+"&zoom="+ak+ah+aa+am+ai+X}function a(X,i){if(I){u.removeLayer(I)}I=new L.OsmMarker(X,{ctrl:J,icon:new L.StartIcon()});I.on("dblclick",function(Y){w();k(false)});I.on("dragend",function(Y){k(false);t.setLocationValue(this.getLatLng())});u.addLayer(I);k(i)}function w(){if(I){u.removeLayer(I)}I=null;t.clearValue()}function r(X,i){if(M){u.removeLayer(M)}M=new L.OsmMarker(X,{ctrl:J,icon:new L.EndIcon()});M.on("dblclick",function(Y){b();k(false)});M.on("dragend",function(Y){k(false);j.setLocationValue(this.getLatLng())});u.addLayer(M);k(i)}function b(){if(M){u.removeLayer(M)}M=null;j.clearValue()}function f(X){var i=new L.OsmMarker(X,{ctrl:J,draggable:true,icon:new L.ViaIcon()});i.on("dragend",function(Y){k(false)});i.on("dblclick",function(Y){H.remove(this);u.removeLayer(this);k(false)});H.push(i);u.addLayer(i);k(false)}function g(){for(var X=0;X<H.length;X++){u.removeLayer(H[X])}H=new Array()}function K(i,X){if(y){u.removeLayer(y)}y=new L.OsmMarker(i,{ctrl:J,mouseoverText:Ext.ux.ts.tr("Double click to remove")});y.on("dblclick",function(Y){q()});y.on("dragend",function(Y){T.setLocationValue(y.getLatLng())});u.addLayer(y);if(X){u.panTo(i)}}function q(){if(y){u.removeLayer(y);y=null}T.clearValue()}function c(){var Y=new Array();for(var X=0;X<H.length;X++){Y.push(Fgh.encode(H[X].getLatLng().lat,H[X].getLatLng().lng,52))}return Y.join(",")}function k(i){if(I&&M){Ext.Ajax.request({failure:function(X){var Y="<h2>"+Ext.ux.ts.tr("No route found")+"</h2>"+Ext.ux.ts.tr("Server is currently unreachable or its answer is invalid.");Ext.Msg.alert(Ext.ux.ts.tr("Not found"),Y)},method:"GET",params:{start:Fgh.encode(I.getLatLng().lat,I.getLatLng().lng,52),dest:Fgh.encode(M.getLatLng().lat,M.getLatLng().lng,52),via:c()},success:function(Y){if(P){u.removeLayer(P)}var af=Ext.decode(Y.responseText);var ak=Ext.ux.osrm.RoutingGeometry.show(af);var X=[];Ext.each(ak,function(ar,ap,aq){X.push(new L.LatLng(ar[0],ar[1]))});P=new L.Polyline(X,{color:"blue"});P.on("mouseover",function(ap){J.setText(Ext.ux.ts.tr("Click to add new via point"))});P.on("mouseout",function(ap){J.setText("")});P.on("click",function(ap){f(ap.latlng)});u.addLayer(P);if(i){u.fitBounds(new L.LatLngBounds(X))}var ag=l.overwrite("route-result-panel",{tag:"table",cls:"result-table"});var Z=af.route_instructions;var ah=0;for(var al=0;al<Z.length;al++){var aa=(al%2==0)?"route-instructions-even":"";var ae=(Z[al][1]!="")?"on "+Z[al][1]:"";var ao=Z[al][2];ah+=parseInt(ao);var aj=ao>1000?Number(parseInt(ao/10)/100)+" km":ao+" m";B.append(ag,[(al+1),aa,Z[al][6],ae,aj])}var ad=l.append(ag,{tag:"tr",id:"credit-row",children:[{"class":"route-credit",colspan:3,children:[{html:Ext.ux.ts.tr("Routing powered by "),tag:"span"},{"class":"external",href:"http://project-osrm.org/",html:"OSRM",tag:"a"}],tag:"td"}]});var ab=af.route_summary.total_time;var am=parseInt(ab/3600);var ac=parseInt(((ab/3600)-am)*60);var ai=Number(parseInt(ah/10)/100);var an=l.overwrite("route-summary-panel",{tag:"div"});n.append(an,[ai,am,ac])},url:"/directions"})}else{g();l.overwrite("route-summary-panel","");l.overwrite("route-result-panel","");if(P){u.removeLayer(P)}}}var z=Ext.select(".external");z.on("click",function(X,Y,Z){var i=Y.href;Y.href="/redirect/?u="+escape(i)})});Ext.namespace("Ext.ux");Ext.ux.LanguageButton=Ext.extend(Ext.Button,{language:"Lao",languageCode:"lo",url:"/",initComponent:function(){var a={enableToggle:true,handler:function(b){Ext.util.Cookies.set("_osm_la[__LANG__]",this.languageCode,new Date().add(Date.DAY,30));window.location.href=this.url+"?lang="+this.languageCode},listeners:{mouseover:function(c,b){this.statusControl.setText(Ext.ux.ts.tr(this.language))},mouseout:function(c,b){this.statusControl.setText("")}},iconCls:this.languageCode+"-button",pressed:this.currentLang==this.languageCode,toggleGroup:"languageToggleGroup"};Ext.apply(this,a);Ext.ux.LanguageButton.superclass.initComponent.call(this)}});Ext.reg("ux_languagebutton",Ext.ux.LanguageButton);Ext.ux.LanguageToolbar=Ext.extend(Ext.Toolbar,{initComponent:function(){var a={items:["->",{currentLang:this.currentLang,language:"Lao",languageCode:"lo",statusControl:this.statusControl,style:{padding:"0px 2px 0px"},url:this.url,xtype:"ux_languagebutton"},{currentLang:this.currentLang,language:"English",languageCode:"en",statusControl:this.statusControl,style:{padding:"0px 2px 0px"},url:this.url,xtype:"ux_languagebutton"}]};Ext.apply(this,a);Ext.ux.LanguageToolbar.superclass.initComponent.call(this)}});Ext.reg("ux_languagetoolbar",Ext.ux.LanguageToolbar);Ext.ux.LocationComboBox=Ext.extend(Ext.form.ComboBox,{map:null,initComponent:function(){var a={emptyText:Ext.ux.ts.tr("Search village, hotel, restaurant, shop, etc."),store:new Ext.data.JsonStore({proxy:new Ext.data.HttpProxy({method:"GET",url:"/places"}),root:"data",idProperty:"hash",fields:["name","hash","feature"]}),loadingText:Ext.ux.ts.tr("Loading..."),valueField:"hash",displayField:"name",iconClsField:"feature",typeAhead:false,minChars:3,mode:"remote",queryParam:"q",hideTrigger:true,selectOnFocus:true,tpl:'<tpl for="."><div class="x-combo-list-item"><table><tbody><tr><td><div class="x-poi-{feature} x-icon-combo-icon"></div></td><td>{name}</td></tr></tbody></table></div></tpl>',xtype:"combo"};Ext.apply(this,a);Ext.ux.LocationComboBox.superclass.initComponent.call(this)},setLocationValue:function(b){var a="Lat: "+Math.round(b.lat*10000)/10000+", Lon: "+Math.round(b.lng*10000)/10000;this.setValue(a)}});Ext.reg("ux_locationcombo",Ext.ux.LocationComboBox);Ext.ux.MapPanel=Ext.extend(Ext.Panel,{center:null,editTpl:null,editEl:null,map:null,zoom:null,initComponent:function(){var a={};Ext.applyIf(this,a);Ext.ux.MapPanel.superclass.initComponent.call(this)},afterRender:function(){var a=this.ownerCt.getSize();Ext.applyIf(this,a);Ext.ux.MapPanel.superclass.afterRender.call(this);this.map.setView(this.center,this.zoom);this.map.on("dragend",function(b){this.center=this.map.getCenter();this.updateTpl();this.updateCookie()},this);this.map.on("zoomend",function(b){this.zoom=this.map.getZoom();this.updateTpl();this.updateCookie()},this);this.updateTpl()},onResize:function(a,b){Ext.ux.MapPanel.superclass.onResize.call(this,a,b);if(this.map){this.map.setView(this.center,this.zoom);this.map.invalidateSize()}},setSize:function(c,a,b){Ext.ux.MapPanel.superclass.setSize.call(this,c,a,b);if(this.map){this.map.setView(this.center,this.zoom);this.map.invalidateSize()}},getMap:function(){return this.map},updateTpl:function(){if(this.editTpl){this.editTpl.overwrite(this.editEl,{zoom:this.map.getZoom(),lat:this.center.lat,lon:this.center.lng})}},updateCookie:function(){var a=this.map.getCenter().lng+" "+this.map.getCenter().lat+" "+this.map.getZoom();Ext.util.Cookies.set("_osm_la[__LOCATION__]",a,new Date().add(Date.DAY,30))}});Ext.reg("mappanel",Ext.ux.MapPanel);(function(){var a="0123456789bcdefghjkmnpqrstuvwxyz";var d=[0,1,0,1,2,3,2,3,0,1,0,1,2,3,2,3,4,5,4,5,6,7,6,7,4,5,4,5,6,7,6,7];var b=[0,1,4,5,16,17,20,21,64,65,68,69,80,81,84,85,256,257,260,261,272,273,276,277,320,321,324,325,336,337,340,341];function f(g,h){return(a.indexOf(g.charAt(h))<<5)|(a.indexOf(g.charAt(h+1)))}function c(g){return d[g&31]|(d[(g>>6)&15]<<3)}function e(i){var g=0,h=0;while(i>0){low=i&255;g|=b[low]<<h;i>>=8;h+=16}return g}window.Fgh={decode:function(m){var h=m.length,k,j,l=0,g=0;if(h&1){j=(a.indexOf(m.charAt(h-1))<<5)}else{j=f(m,h-2)}g=(c(j))/32;l=(c(j>>1))/32;for(k=(h-2)&~1;k>=0;k-=2){j=f(m,k);g=(c(j)+g)/32;l=(c(j>>1)+l)/32}return{lat:180*(g-0.5),lon:360*(l-0.5)}},encode:function(p,h,s){p=p/180+0.5;h=h/360+0.5;var g="",m=Math.ceil(s/10),t,k,q,j,o,n;for(n=0;n<m;++n){p*=32;h*=32;t=Math.min(31,Math.floor(p));k=Math.min(31,Math.floor(h));p-=t;h-=k;q=e(t)|(e(k)<<1);j=q>>5;o=q&31;g+=a.charAt(j)+a.charAt(o)}g=g.substr(0,Math.ceil(s/5));return g},checkValid:function(g){return !!g.match(/^[0-9b-hjkmnp-z]+$/)}}})();Ext.namespace("Ext.ux.osrm");Ext.ux.osrm.PRECISION=6;Ext.ux.osrm.RoutingGeometry={show:function(a){var b=Ext.ux.osrm.RoutingGeometry._decode(a.route_geometry,Ext.ux.osrm.PRECISION);return b},_decode:function(c,d){d=Math.pow(10,-d);var f=c.length,e=0,j=0,k=0,h=[];while(e<f){var l,a=0,m=0;do{l=c.charCodeAt(e++)-63;m|=(l&31)<<a;a+=5}while(l>=32);var g=((m&1)?~(m>>1):(m>>1));j+=g;a=0;m=0;do{l=c.charCodeAt(e++)-63;m|=(l&31)<<a;a+=5}while(l>=32);var i=((m&1)?~(m>>1):(m>>1));k+=i;h.push([j*d,k*d])}return h}};